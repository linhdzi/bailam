import 'dart:io';
import 'dart:convert';

class Student {
  String name;
  int age;
  double weight;
  double height;
  double gpa;
  String rank;

  // Constructor
  Student({
    required this.name,
    required this.age,
    required this.weight,
    required this.height,
    required this.gpa,
  }) : rank = _calculateRank(gpa);

  // Calculate BMI
  double get bmi {
    if (height <= 0 || weight <= 0) return double.nan;
    return double.parse((weight / ((height / 100) * (height / 100))).toStringAsFixed(2));
  }

  // Calculate Rank based on GPA
  static String _calculateRank(double gpa) {
    if (gpa < 0) return "Invalid";
    if (gpa > 8.5) return "A";
    if (gpa >= 7.5) return "B";
    if (gpa >= 6.5) return "C";
    return "D";
  }

  // Convert object to JSON
  Map<String, dynamic> toJson() {
    return {
      'name': name,
      'age': age,
      'weight': weight,
      'height': height,
      'gpa': gpa,
    };
  }

  // Create object from JSON
  static Student? fromJson(String jsonString) {
    try {
      Map<String, dynamic> data = jsonDecode(jsonString);
      return Student(
        name: data['name'],
        age: data['age'],
        weight: data['weight'],
        height: data['height'],
        gpa: data['gpa'],
      );
    } catch (e) {
      return null; // If JSON format is incorrect
    }
  }
}

void main() {
  // Enter student information
  stdout.write("Enter name: ");
  String name = stdin.readLineSync()!;
  
  stdout.write("Enter age: ");
  int age = int.parse(stdin.readLineSync()!);

  stdout.write("Enter weight: ");
  double weight = double.parse(stdin.readLineSync()!);

  stdout.write("Enter height: ");
  double height = double.parse(stdin.readLineSync()!);

  stdout.write("Enter GPA: ");
  double gpa = double.parse(stdin.readLineSync()!);

  // Create Student object
  Student student = Student(name: name, age: age, weight: weight, height: height, gpa: gpa);

  // Display BMI and Rank
  print("BMI: ${student.bmi}");
  print("Rank: ${student.rank}");

  // Convert to JSON
  String jsonStr = jsonEncode(student.toJson());
  print("JSON String: $jsonStr");

  // Enter JSON string and create Student object
  stdout.write("Enter JSON String: ");
  String inputJson = stdin.readLineSync()!;

  Student? newStudent = Student.fromJson(inputJson);
  if (newStudent == null) {
    print("Invalid");
  } else {
    print("BMI: ${newStudent.bmi}");
    print("Rank: ${newStudent.rank}");
  }
}
